<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/cabin.png">
    <link href="/styles/main.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Quicksand:300|Source+Code+Pro:400,700|Quattrocento+Sans:400,400italic,700,700italic" rel="stylesheet">
    <title>When Python 3 is easier than Python 2 :: not.even.code.</title>
  </head>
  <body>
    <div class="center">
      <nav class="group">
        <h2 title="Well, maybe a bit." class="name"><a href="/">not.even.code.</a></h2>
        <ul class="nav-links">
          <li class="text-link"><a href="/about.html">about</a></li>
          <li class="text-link"><a href="/archive.html">archive</a></li>
        </ul>
      </nav>
      <div class="post-head group"><a href="/posts/when-python-3-is-easier-than-python-2/">
          <h1 class="post-title">When Python 3 is easier than Python 2</h1></a>
        <p class="post-date"></p>
      </div>
      <div class="post-body"><p>Python 3 is not universally popular, and is not always seen as
a <a href="http://lucumr.pocoo.org/2014/1/5/unicode-in-2-and-3/" title="More About Unicode in Python 2 and 3">universal improvement</a> on it&#39;s predecessor.</p>
<p>However, there must have been a reason that Guido &amp; Company decided
a backwards compatibility break was warranted to improve something,
right? Since there has recently been a lot of negative press about
the new major version and even the future of the language itself
(<a href="https://en.wikipedia.org/wiki/Betteridge%27s_Law_of_Headlines">Is Python The Next Perl?</a>), I thought I&#39;d share at least
one example of Python 3 improving the situation where Python 2 is horrible.</p>
<!-- more -->

<h2><a name="how-to-log-"class="anchor" href="#how-to-log-"><span class="header-link"></span></a>How to Log?</h2>
<p>Everyone knows to use Python&#39;s at least satisfactory, if not wonderful,
<a href="https://www.youtube.com/watch?v=24_4WWkSmNo">logging package</a>, right? Well, not <a href="https://github.com/pypa/pip/blob/1.5.X/pip/log.py">pip</a>. Sometime in
the past, a custom class was created to do so instead. I&#39;m sure it was
written at a time when writing your own logging module to handle all
output and input was a perfectly acceptable idea. Unfortunately, it&#39;s
not easily replaced - it has similar, but not quite the same behaviour as
<a href="https://docs.python.org/3/library/logging.html#logger-objects">logging.Logger</a>, and it doesn&#39;t <em>just</em> log, either - it&#39;s used
for practically all cli output (including progress bars and such). It&#39;s
old code but it works (mostly) and is not so simple to replace, so it sits
as a medium-long term enhancement issue amongst the many, many things pip
could do better.</p>
<h2><a name="it-works-until-it-doesn-t-"class="anchor" href="#it-works-until-it-doesn-t-"><span class="header-link"></span></a>It works! Until it doesn&#39;t.</h2>
<p>You might have guessed, but the overall problem here is one of text-encoding.
Like most Python 2 encoding problems, everything works fine almost all
of the time... until someone has the audacity to <a href="https://github.com/pypa/pip/issues/1713">use a login name
not entirely consisting of ascii</a> or merely <a href="https://github.com/pypa/pip/issues/1137">anything in the
log is not ascii</a>. As per usual, Python has been silently
encoding things into ascii for us until something blew up and we realize
the code was never written to deal with unicode or extended character sets
in the first place. So we find out our logging code is not quite perfect.</p>
<p>Unfortunately, pip is a Python 2 &amp; 3 code base, so it has to work nicely with
both. If it were Python 3, solving this problem (or at least
providing a fix that doesn&#39;t break and throw horrible tracebacks)
would be simple. Even if you can&#39;t control what someone wants to write the
log (no, not the content, but what Python type they&#39;ve provided it in) at
the very least you know that if you get bytes you can only decode them,
and if you have a string you can only encode it. After a tiny bit of logic
to deal with either case, you can provide the <code>ignore</code> or <code>replace</code>
second argument to the <code>{en,de}code</code> call you run and at the very
least you&#39;ll stop producing runtime errors. Of course, if pip were a python
3 only application then all <code>str</code>s would be unicode in the first place,
and we never have encountered this problem after opening a log file
in a permissive encoding.</p>

        <h3 class="signature">- Matt.</h3></div>
      <!-- Disqus comments-->
      <div id="comments">
        <div id="disqus_thread"></div>
      </div>
      <script>
        var disqus_shortname = 'notevencode'; // Change this to your Disqus account name
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div><a href="http://cabinjs.com"><img src="/images/cabin.png" alt="CabinJS" class="cabin"></a>
    <!-- Piwik-->
    <script>
      var _paq = _paq || [];
      _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
      _paq.push(["setCookieDomain", "*.notevencode.com"]);
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);
      
      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.notevencode.com/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "1"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript><img src="http://piwik.notevencode.com/piwik.php?idsite=1" style="border:0" alt=""></noscript>
  </body>
</html>